<link rel="import" href="import-lit-html.html">
<link rel="import" href="properties-element.html">

<script>
	class GrainLitElement extends Polymer.PropertiesElement {

		constructor() {
			super();
			let propsKeys = Object.keys(this.constructor.properties);
			for (let i=0; i < propsKeys.length; i++) {
				let propName = propsKeys[i];
				let prop = this.constructor.properties[propName];
				if (prop.value) {
					this._setProperty(propName, prop.value);
				}
			}
		}

		_propertiesChanged(allValues, newValues, oldValues, passOn) {
			super._propertiesChanged(allValues, newValues, oldValues, passOn);
			let propNames = Object.keys(newValues);
			for (let i=0; i < propNames.length; i++) {
				let propName = propNames[i];
				let observerFunctionName = this.constructor.properties[propName].observer;
				if (observerFunctionName) {
					if (this[observerFunctionName]) {
						this[observerFunctionName](newValues[propName], oldValues[propName]);
					}
				}
			}
			this.update();
		}

		update() {
			if (this.shadowRoot) {
				render(this.render(), this.shadowRoot);
			}
		}

		connectedCallback() {
			if (!this.shadowRoot) {
				this.attachShadow({mode: 'open'});
			}
			super.connectedCallback();
		}

	}
</script>
